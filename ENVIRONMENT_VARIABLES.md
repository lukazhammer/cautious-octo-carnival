# Brandora - Environment Variables Reference Guide

Complete reference for all environment variables needed for Brandora deployment.

---

## Table of Contents

1. [Overview](#overview)
2. [How to Set Environment Variables](#how-to-set-environment-variables)
3. [Application Settings](#application-settings)
4. [Supabase Configuration](#supabase-configuration)
5. [Stripe Configuration](#stripe-configuration)
6. [Brevo Email Configuration](#brevo-email-configuration)
7. [Perplexity AI Configuration](#perplexity-ai-configuration)
8. [Authentication & Security](#authentication--security)
9. [Analytics & Monitoring](#analytics--monitoring)
10. [Feature Flags](#feature-flags)
11. [Environment-Specific Values](#environment-specific-values)
12. [Security Best Practices](#security-best-practices)

---

## Overview

Brandora requires various environment variables for different services and integrations. This guide provides detailed information on how to obtain, configure, and manage these variables.

### Variable Naming Conventions

- **NEXT_PUBLIC_***: Variables exposed to the browser (client-side)
- **No prefix**: Server-side only variables (secrets, API keys)
- **Never** commit actual values to Git (use .env.example only)

### Variable Scopes in Vercel

| Scope | When Used | Example |
|-------|-----------|---------|
| **Production** | Production deployments (main branch) | Live Stripe keys |
| **Preview** | Preview deployments (PRs, feature branches) | Test Stripe keys |
| **Development** | Local development with `vercel dev` | Local URLs |

---

## How to Set Environment Variables

### Method 1: Vercel Dashboard (Recommended)

1. Go to https://vercel.com/dashboard
2. Select your project
3. Navigate to **Settings → Environment Variables**
4. Click **Add New**
5. Enter:
   - **Name**: Variable name (e.g., `STRIPE_SECRET_KEY`)
   - **Value**: The actual value
   - **Environment**: Select Production, Preview, or Development
6. Click **Save**

**Important**: After adding/modifying environment variables, you must **redeploy** for changes to take effect.

### Method 2: Vercel CLI

```bash
# Add a single variable
vercel env add VARIABLE_NAME production

# Pull environment variables to local
vercel env pull .env.local

# List all environment variables
vercel env ls
```

### Method 3: .env.local (Local Development Only)

```bash
# Copy the example file
cp .env.example .env.local

# Edit .env.local with your values
nano .env.local
```

**Never commit .env.local to Git!** (Already in .gitignore)

---

## Application Settings

### NODE_ENV

**Purpose**: Defines the runtime environment

| Environment | Value |
|-------------|-------|
| Production | `production` |
| Preview | `preview` or `production` |
| Development | `development` |

**Scope**: All (Production, Preview, Development)

**How to set**:
- Vercel automatically sets this
- For local development, add to `.env.local`:
  ```bash
  NODE_ENV=development
  ```

---

### NEXT_PUBLIC_APP_URL

**Purpose**: The base URL of your application, used for:
- OAuth redirects
- Email links
- Sitemap generation
- API callbacks

| Environment | Value | Scope |
|-------------|-------|-------|
| Production | `https://brandora.com` | Production |
| Preview | Auto-generated by Vercel | Preview |
| Development | `http://localhost:3000` | Development |

**How to set**:

**In Vercel Dashboard**:
1. Go to **Settings → Environment Variables**
2. Add variable:
   - Name: `NEXT_PUBLIC_APP_URL`
   - Value: `https://brandora.com`
   - Environment: **Production only**

For Preview deployments, Vercel automatically provides this as `VERCEL_URL`.

**In code, use**:
```typescript
const baseUrl = process.env.NEXT_PUBLIC_APP_URL || `https://${process.env.VERCEL_URL}`;
```

---

## Supabase Configuration

Supabase is used for:
- User authentication
- Database storage
- Real-time subscriptions
- File storage

### NEXT_PUBLIC_SUPABASE_URL

**Purpose**: Your Supabase project API URL

**Format**: `https://xxxxxxxxxxxxx.supabase.co`

**Scope**: All (Production, Preview, Development)

**How to get**:
1. Go to https://app.supabase.com
2. Select your project
3. Navigate to **Settings → API**
4. Copy the **URL** under "Project URL"

**Example**:
```bash
NEXT_PUBLIC_SUPABASE_URL=https://abcdefghijklmnop.supabase.co
```

---

### NEXT_PUBLIC_SUPABASE_ANON_KEY

**Purpose**: Public/anonymous key for client-side Supabase queries

**Format**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` (long JWT string)

**Scope**: All (Production, Preview, Development)

**Security**: Safe to expose publicly (has limited permissions via RLS)

**How to get**:
1. Go to https://app.supabase.com
2. Select your project
3. Navigate to **Settings → API**
4. Copy the **anon public** key under "Project API keys"

**Example**:
```bash
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMDAwMDAwMCwiZXhwIjoxOTQ1NTc2MDAwfQ.xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

### SUPABASE_SERVICE_ROLE_KEY

**Purpose**: Admin key for server-side operations (bypasses RLS)

**Format**: `eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...` (long JWT string)

**Scope**: All (Production, Preview, Development)

**Security**: ⚠️ **HIGHLY SENSITIVE** - Never expose to client-side code

**Use cases**:
- Admin operations
- Bypassing Row Level Security
- Background jobs
- Server-side user management

**How to get**:
1. Go to https://app.supabase.com
2. Select your project
3. Navigate to **Settings → API**
4. Copy the **service_role** key under "Project API keys"

**Example**:
```bash
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiY2RlZmdoaWprbG1ub3AiLCJyb2xlIjoic2VydmljZV9yb2xlIiwiaWF0IjoxNjMwMDAwMDAwLCJleHAiOjE5NDU1NzYwMDB9.xxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

### SUPABASE_DB_URL (Optional)

**Purpose**: Direct PostgreSQL connection string

**Format**: `postgresql://postgres:[password]@db.[project].supabase.co:5432/postgres`

**Scope**: Server-side only (Production, Preview)

**Use cases**:
- Database migrations
- Direct database queries
- ORM connections (Prisma, Drizzle)

**How to get**:
1. Go to https://app.supabase.com
2. Select your project
3. Navigate to **Settings → Database**
4. Copy the **Connection string** under "Connection string"
5. Replace `[password]` with your database password

**Example**:
```bash
SUPABASE_DB_URL=postgresql://postgres:your-password@db.abcdefghijklmnop.supabase.co:5432/postgres
```

---

## Stripe Configuration

Stripe is used for payment processing. You need **different keys** for Production and Preview environments.

### Production vs Test Mode

| Environment | Stripe Mode | Key Prefix |
|-------------|-------------|------------|
| Production | Live mode | `pk_live_`, `sk_live_` |
| Preview | Test mode | `pk_test_`, `sk_test_` |
| Development | Test mode | `pk_test_`, `sk_test_` |

**Critical**: Never use live keys in Preview/Development!

---

### NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY

**Purpose**: Public key for Stripe.js on the client-side

**Format**:
- Live: `pk_live_51...`
- Test: `pk_test_51...`

**Scope**:
- Production: Use `pk_live_`
- Preview: Use `pk_test_`
- Development: Use `pk_test_`

**Security**: Safe to expose publicly

**How to get**:
1. Go to https://dashboard.stripe.com/apikeys
2. Toggle **Viewing test data** (top right) for test keys, or turn off for live keys
3. Copy the **Publishable key**

**Example**:
```bash
# Production
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=your_stripe_live_publishable_key_here

# Preview/Development
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=your_stripe_test_publishable_key_here
```

---

### STRIPE_SECRET_KEY

**Purpose**: Server-side Stripe API key

**Format**:
- Live: `sk_live_51...`
- Test: `sk_test_51...`

**Scope**:
- Production: Use `sk_live_`
- Preview: Use `sk_test_`
- Development: Use `sk_test_`

**Security**: ⚠️ **HIGHLY SENSITIVE** - Server-side only, never expose to client

**How to get**:
1. Go to https://dashboard.stripe.com/apikeys
2. Toggle **Viewing test data** for test keys, or turn off for live keys
3. Copy the **Secret key** (click "Reveal test key")

**Example**:
```bash
# Production
STRIPE_SECRET_KEY=your_stripe_live_secret_key_here

# Preview/Development
STRIPE_SECRET_KEY=your_stripe_test_secret_key_here
```

---

### STRIPE_WEBHOOK_SECRET

**Purpose**: Verify webhook events from Stripe

**Format**: `whsec_...`

**Scope**: Different for Production and Preview

**Security**: Keep secret to prevent webhook spoofing

**How to get**:

**For Production**:
1. Go to https://dashboard.stripe.com/webhooks
2. Click **Add endpoint**
3. Enter URL: `https://brandora.com/api/webhooks/stripe`
4. Select events:
   - `checkout.session.completed`
   - `customer.subscription.created`
   - `customer.subscription.updated`
   - `customer.subscription.deleted`
   - `invoice.paid`
   - `invoice.payment_failed`
5. Click **Add endpoint**
6. Copy the **Signing secret**

**For Preview** (optional):
1. Create separate webhook endpoint with your preview URL
2. Get separate signing secret

**Example**:
```bash
# Production
STRIPE_WEBHOOK_SECRET=whsec_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

# Preview
STRIPE_WEBHOOK_SECRET=whsec_yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy
```

**Testing locally**:
```bash
# Use Stripe CLI to forward webhooks to localhost
stripe listen --forward-to localhost:3000/api/webhooks/stripe
# CLI will provide a temporary webhook secret (whsec_...)
```

---

### Stripe Price IDs

**Purpose**: Link pricing tiers to Stripe products

**Format**: `price_...`

**Scope**: All (same for Production and Preview if using same products)

#### NEXT_PUBLIC_STRIPE_PRICE_STARTER

**How to get**:
1. Go to https://dashboard.stripe.com/products
2. Create product: "Clarity Starter" (Free tier)
3. Add price: $0.00 (one-time)
4. Copy the **Price ID**

**Example**:
```bash
NEXT_PUBLIC_STRIPE_PRICE_STARTER=price_1HqvF2SIxxxxxxxxxxxxxxxxxxx
```

#### NEXT_PUBLIC_STRIPE_PRICE_PRO

**How to get**:
1. Create product: "Market Fit Pro"
2. Add price: $147.00 (one-time)
3. Copy the **Price ID**

**Example**:
```bash
NEXT_PUBLIC_STRIPE_PRICE_PRO=price_1HqvF3SIxxxxxxxxxxxxxxxxxxx
```

#### NEXT_PUBLIC_STRIPE_PRICE_DESIGN_READY

**How to get**:
1. Create product: "Design Ready"
2. Add price: $497.00 (one-time)
3. Copy the **Price ID**

**Example**:
```bash
NEXT_PUBLIC_STRIPE_PRICE_DESIGN_READY=price_1HqvF4SIxxxxxxxxxxxxxxxxxxx
```

---

## Brevo Email Configuration

Brevo (formerly Sendinblue) is used for transactional emails.

### BREVO_API_KEY

**Purpose**: Authenticate with Brevo API

**Format**: `xkeysib-...`

**Scope**: All (Production, Preview, Development)

**Security**: ⚠️ **SENSITIVE** - Server-side only

**How to get**:
1. Go to https://app.brevo.com/settings/keys/api
2. Click **Generate a new API key**
3. Enter a name (e.g., "Brandora Production")
4. Copy the generated key

**Example**:
```bash
BREVO_API_KEY=xkeysib-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Note**: You can use the same API key for all environments, or create separate keys for better tracking.

---

### BREVO_FROM_EMAIL

**Purpose**: Default "from" email address

**Format**: Valid email address

**Scope**: All

**Requirements**:
- Must be a verified sender in Brevo
- Recommended: Use your domain (e.g., `hello@brandora.com`)

**How to verify**:
1. Go to https://app.brevo.com/senders
2. Click **Add a new sender**
3. Enter email and name
4. Verify email (check inbox for verification email)

**Example**:
```bash
BREVO_FROM_EMAIL=hello@brandora.com
```

---

### BREVO_FROM_NAME

**Purpose**: Default "from" name shown to recipients

**Format**: Any string

**Scope**: All

**Example**:
```bash
BREVO_FROM_NAME=Brandora
```

---

### Brevo Template IDs (Optional)

If you create email templates in Brevo dashboard, reference them by ID.

#### BREVO_TEMPLATE_WELCOME

**Purpose**: Welcome email template ID

**How to get**:
1. Go to https://app.brevo.com/camp/template/listing
2. Create a new template for welcome emails
3. Copy the template ID (number)

**Example**:
```bash
BREVO_TEMPLATE_WELCOME=1
```

#### BREVO_TEMPLATE_STRATEGY_READY

**Purpose**: Notification when strategy is ready

**Example**:
```bash
BREVO_TEMPLATE_STRATEGY_READY=2
```

#### BREVO_TEMPLATE_PAYMENT_CONFIRMATION

**Purpose**: Payment confirmation email

**Example**:
```bash
BREVO_TEMPLATE_PAYMENT_CONFIRMATION=3
```

---

## Perplexity AI Configuration

Perplexity AI is used for AI-powered brand strategy research.

### PERPLEXITY_API_KEY

**Purpose**: Authenticate with Perplexity API

**Format**: `pplx-...`

**Scope**: All (Production, Preview, Development)

**Security**: ⚠️ **SENSITIVE** - Server-side only

**How to get**:
1. Go to https://www.perplexity.ai/settings/api
2. Sign in or create account
3. Click **Generate API Key**
4. Copy the key (starts with `pplx-`)

**Example**:
```bash
PERPLEXITY_API_KEY=pplx-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**Pricing**: Check https://www.perplexity.ai/pricing for current rates.

---

### PERPLEXITY_MODEL

**Purpose**: Specify which Perplexity model to use

**Format**: Model identifier string

**Scope**: All

**Available models**:
- `llama-3.1-sonar-small-128k-online` - Faster, cheaper
- `llama-3.1-sonar-large-128k-online` - More accurate (recommended)
- `llama-3.1-sonar-huge-128k-online` - Most powerful

**Example**:
```bash
PERPLEXITY_MODEL=llama-3.1-sonar-large-128k-online
```

**Recommendation**: Start with `large` model, downgrade to `small` if cost is an issue.

---

## Authentication & Security

### NEXTAUTH_SECRET

**Purpose**: Secret key for NextAuth.js session encryption

**Format**: Random 32+ character string (base64)

**Scope**: All (Production, Preview, Development)

**Security**: ⚠️ **CRITICAL** - Must be different for each environment

**How to generate**:
```bash
# On macOS/Linux
openssl rand -base64 32

# Or use Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Or online generator
# https://generate-secret.vercel.app/32
```

**Example**:
```bash
NEXTAUTH_SECRET=X9fJ8kL3mN5pQ7rS9tV2wY4zA6bC8dE1fG3hI5jK7lM9nO1p=
```

**Important**: Generate separate secrets for Production and Preview!

---

### NEXTAUTH_URL

**Purpose**: The canonical URL of your site for NextAuth

**Format**: Full URL with protocol

**Scope**:
- Production: Your domain
- Preview: Auto-detected by Vercel
- Development: `http://localhost:3000`

**How to set**:
```bash
# Production
NEXTAUTH_URL=https://brandora.com

# Development
NEXTAUTH_URL=http://localhost:3000
```

**Note**: For Vercel deployments, this is usually auto-detected. Only set explicitly if you have issues.

---

## Analytics & Monitoring

### NEXT_PUBLIC_GA_MEASUREMENT_ID

**Purpose**: Google Analytics 4 measurement ID

**Format**: `G-XXXXXXXXXX`

**Scope**: Production (optional for Preview)

**How to get**:
1. Go to https://analytics.google.com
2. Create a property (if not exists)
3. Go to **Admin → Data Streams**
4. Create a web stream
5. Copy the **Measurement ID**

**Example**:
```bash
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-ABC123DEF4
```

---

### NEXT_PUBLIC_SENTRY_DSN

**Purpose**: Sentry error tracking DSN

**Format**: `https://[key]@[org].ingest.sentry.io/[project]`

**Scope**: All (Production, Preview, Development)

**How to get**:
1. Go to https://sentry.io
2. Create a project
3. Copy the **DSN** from project settings

**Example**:
```bash
NEXT_PUBLIC_SENTRY_DSN=https://abcd1234efgh5678ijkl9012mnop3456@o123456.ingest.sentry.io/7890123
```

---

### SENTRY_AUTH_TOKEN

**Purpose**: Upload source maps to Sentry

**Format**: `sntrys_...`

**Scope**: All (Production, Preview)

**How to get**:
1. Go to https://sentry.io/settings/account/api/auth-tokens/
2. Create a new token
3. Grant permissions: `project:read`, `project:releases`, `org:read`
4. Copy the token

**Example**:
```bash
SENTRY_AUTH_TOKEN=sntrys_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

---

## Feature Flags

### NEXT_PUBLIC_ENABLE_ANALYTICS

**Purpose**: Toggle analytics on/off

**Format**: `true` or `false`

**Scope**: All

**Example**:
```bash
NEXT_PUBLIC_ENABLE_ANALYTICS=true
```

---

### NEXT_PUBLIC_ENABLE_CHAT_SUPPORT

**Purpose**: Enable/disable live chat widget

**Format**: `true` or `false`

**Scope**: All

**Example**:
```bash
NEXT_PUBLIC_ENABLE_CHAT_SUPPORT=false
```

---

### NEXT_PUBLIC_MAINTENANCE_MODE

**Purpose**: Show maintenance page

**Format**: `true` or `false`

**Scope**: All

**Example**:
```bash
NEXT_PUBLIC_MAINTENANCE_MODE=false
```

---

## Environment-Specific Values

### Production Environment

```bash
# Application
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://brandora.com

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...

# Stripe (LIVE keys)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_51...
STRIPE_SECRET_KEY=sk_live_51...
STRIPE_WEBHOOK_SECRET=whsec_...

# Brevo
BREVO_API_KEY=xkeysib-...
BREVO_FROM_EMAIL=hello@brandora.com
BREVO_FROM_NAME=Brandora

# Perplexity
PERPLEXITY_API_KEY=pplx-...
PERPLEXITY_MODEL=llama-3.1-sonar-large-128k-online

# Auth
NEXTAUTH_SECRET=<generate-unique-secret>
NEXTAUTH_URL=https://brandora.com

# Analytics
NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX
NEXT_PUBLIC_ENABLE_ANALYTICS=true
```

---

### Preview Environment

```bash
# Application
NODE_ENV=preview
# NEXT_PUBLIC_APP_URL is auto-set by Vercel

# Supabase (can use same or separate project)
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...

# Stripe (TEST keys)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51...
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_WEBHOOK_SECRET=whsec_... (different from production)

# Brevo (can use same)
BREVO_API_KEY=xkeysib-...
BREVO_FROM_EMAIL=hello@brandora.com
BREVO_FROM_NAME=Brandora (Preview)

# Perplexity (can use same)
PERPLEXITY_API_KEY=pplx-...
PERPLEXITY_MODEL=llama-3.1-sonar-large-128k-online

# Auth
NEXTAUTH_SECRET=<different-from-production>
# NEXTAUTH_URL is auto-set by Vercel

# Analytics (optional for preview)
NEXT_PUBLIC_ENABLE_ANALYTICS=false
```

---

### Development Environment (.env.local)

```bash
# Application
NODE_ENV=development
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Supabase (use preview/test project)
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGc...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGc...

# Stripe (TEST keys)
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_test_51...
STRIPE_SECRET_KEY=sk_test_51...
STRIPE_WEBHOOK_SECRET=whsec_... (from Stripe CLI)

# Brevo
BREVO_API_KEY=xkeysib-...
BREVO_FROM_EMAIL=hello@brandora.com
BREVO_FROM_NAME=Brandora (Dev)

# Perplexity
PERPLEXITY_API_KEY=pplx-...
PERPLEXITY_MODEL=llama-3.1-sonar-small-128k-online (cheaper for dev)

# Auth
NEXTAUTH_SECRET=<local-dev-secret>
NEXTAUTH_URL=http://localhost:3000

# Analytics
NEXT_PUBLIC_ENABLE_ANALYTICS=false
DEBUG=true
```

---

## Security Best Practices

### ✅ DO

1. **Use environment-specific values**
   - Production: Live API keys
   - Preview: Test/sandbox keys
   - Development: Test keys or mock services

2. **Never commit secrets to Git**
   - Add `.env.local`, `.env.*.local` to `.gitignore`
   - Use `.env.example` with placeholder values only

3. **Rotate secrets regularly**
   - Change API keys every 90 days
   - Immediately rotate if exposed

4. **Use different secrets per environment**
   - Separate `NEXTAUTH_SECRET` for production and preview
   - Different Stripe webhook secrets

5. **Limit API key permissions**
   - Use read-only keys where possible
   - Supabase: Use RLS to restrict `anon` key access

6. **Monitor API usage**
   - Set up billing alerts in Stripe, Perplexity
   - Monitor Supabase usage

### ❌ DON'T

1. **Never hardcode secrets in code**
   ```typescript
   // ❌ BAD
   const apiKey = 'sk_live_12345';

   // ✅ GOOD
   const apiKey = process.env.STRIPE_SECRET_KEY;
   ```

2. **Don't expose server secrets to client**
   ```typescript
   // ❌ BAD - Service role key should never be client-side
   const client = createClient(url, process.env.SUPABASE_SERVICE_ROLE_KEY);

   // ✅ GOOD
   const client = createClient(url, process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);
   ```

3. **Don't use production keys in development**
   - Always use test/sandbox keys locally

4. **Don't share `.env.local` files**
   - Each developer should have their own
   - Use a password manager or 1Password for sharing

5. **Don't use weak secrets**
   - Minimum 32 characters for `NEXTAUTH_SECRET`
   - Use cryptographically secure random generators

---

## Verifying Your Configuration

### Checklist

Run through this checklist after setting environment variables:

- [ ] All required variables are set in Vercel dashboard
- [ ] Production variables use live/production keys
- [ ] Preview variables use test/sandbox keys
- [ ] No secrets are committed to Git
- [ ] `.env.local` exists for local development
- [ ] All `NEXT_PUBLIC_*` variables are properly prefixed
- [ ] Stripe webhooks are configured for production URL
- [ ] Supabase redirect URLs include your domain
- [ ] `NEXTAUTH_SECRET` is unique per environment
- [ ] Test deployment succeeds without errors

### Testing Environment Variables

Add this API route to test variables (remove before production):

```typescript
// app/api/test-env/route.ts
export async function GET() {
  return Response.json({
    supabase: !!process.env.NEXT_PUBLIC_SUPABASE_URL,
    stripe: !!process.env.STRIPE_SECRET_KEY,
    brevo: !!process.env.BREVO_API_KEY,
    perplexity: !!process.env.PERPLEXITY_API_KEY,
    // Never return actual values, only check if they exist
  });
}
```

Visit `/api/test-env` to verify all variables are loaded.

---

## Troubleshooting

### Variable Not Found

**Symptom**: `process.env.VARIABLE_NAME` is `undefined`

**Solutions**:
1. Verify variable name is exact (case-sensitive)
2. For client-side access, ensure it starts with `NEXT_PUBLIC_`
3. Restart Next.js dev server after adding to `.env.local`
4. Redeploy on Vercel after adding to dashboard
5. Check variable is set for correct environment (Production vs Preview)

### Webhook Secret Invalid

**Symptom**: Stripe webhook events fail verification

**Solutions**:
1. Verify `STRIPE_WEBHOOK_SECRET` matches the endpoint
2. Create separate webhooks for production and preview
3. For local testing, use Stripe CLI: `stripe listen --forward-to localhost:3000/api/webhooks/stripe`

### Supabase RLS Issues

**Symptom**: Queries work with service role but not anon key

**Solutions**:
1. Check Row Level Security policies in Supabase dashboard
2. Verify you're using the correct key for the use case
3. Never use service role key on client-side

---

**Last Updated**: 2025-11-15
